
<% if current_user.have_umbrella %>
  <div class="navi_box">
    <h2>傘を持っていないひとからのリクエスト一覧</h2>
    <div class="navi_search">
    </div>
  </div>

  <div class="main_box">
    <table id="request_user_id_is_<%= current_user.id %>">
      <tr>
        <th class="main_name">アカウント名</th>
        <th class="main_area">今いる場所</th>
        <th class="main_gender">性別</th>
        <th class="main_age">年齢</th>
        <th class="main_my_profile" colspan="2"><%= link_to "マイプロフィール", user_path(current_user.id)  %></th>
      </tr>

      <% @matchings.each do |matching| %>
        <% follower = User.find(matching.follower_id) %>
        <% followed = User.find(matching.followed_id) %>
        
        <% if followed.id == current_user.id && follower.have_umbrella == false %>
          <tr class="table_border" id="request_user_list_id_is_<%= follower.id %>">
            <td>
              <%= link_to "#{follower.name}", user_path(follower.id)  %>
            </td>
            <td>
              <%= follower.area %>
            </td>
            <td>
              <%= follower.gender %>
            </td>
            <td>
              <%= follower.age %>
            </td>
          </tr>
        <% end %>
      <% end %>
      
    </table>
        <br>
  </div>

<% else %>

  <% if Matching.find_by(followed_id:current_user.id) %>
    <div class="confirm_box" id="confirm_id_is_<%= current_user.id %>">
      <%= link_to "あなたのリクエストが承諾されました。確認してください。", confirm_request_users_path %>
    </div>
  <% end %>
  <div id="notification_id_is_<%= current_user.id %>"></div>

  <div class="navi_box">
    <h2>傘を持っているひと一覧</h2>
    <div class="navi_search">
      <%= search_form_for @q do |f| %>
        <%= f.label :area, "場所" %>
        <%= f.search_field :area_cont, size: "10x10" %>
        <%= f.label :gender, "性別" %>
        <%= f.select :gender_eq, [['男', 1], ['女', 2], ['どちらでもない', 3]], :include_blank => '未選択' %>
        <%= f.label :age, "年齢" %>
        <%= f.select :age_eq, [['20~26', 1], ['27~33', 2], ['34~40', 3], ['41~47', 4], ['48~60', 5], ['非公開', 6]], :include_blank => '未選択' %>
        <%= f.submit "検索" %>
      <% end %>
    </div>
  </div>

  <div class="main_box">
    <table>
      <tr>
        <th class="main_name">アカウント名</th>
        <th class="main_area">今いる場所</th>
        <th class="main_gender">性別</th>
        <th class="main_age">年齢</th>
        <th class="main_my_profile" colspan="2"><%= link_to "マイプロフィール", user_path(current_user.id)  %></th>
      </tr>
      
      <% @users.each do |user| %>
        <% if user.id != current_user.id && user.have_umbrella && Matching.find_by(follower_id: user.id) == nil %>
            <tr class="table_border" id="having_user_list_id_is_<%= user.id %>">
              <td>
                <%= link_to "#{user.name}", user_path(user.id)  %>
              </td>
              <td><%= user.area %></td>
              <td><%= user.gender %></td>
              <td><%= user.age %></td>
            </tr>
        <% end %>
      <% end %>
      </td></tr>
    </table>
  </div>
<% end %>
